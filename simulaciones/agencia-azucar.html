<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Inventario de Azúcar (revisión cada 7 días)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="Simulación de inventario periódico para agencia de azúcar: demanda exponencial, lead time uniforme y ventas perdidas." />
    <link rel="stylesheet" href="../assets/css/styles.css" />
    <style>
        body {font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif; color:#e9f1ff; background:#0b1118; line-height:1.35;}
        h1 {font-size:1.9rem;margin:0 0 6px;font-weight:650;letter-spacing:.5px;text-align:center;}
        h2 {font-size:1.1rem;margin:0 0 14px;font-weight:600;letter-spacing:.5px;text-transform:uppercase;color:#9fb0c7;}
        p.subtitle {max-width:880px;margin:0 auto 26px;text-align:center;font-size:.95rem;color:#b9c7d8;}
        a.back-link {text-decoration:none;color:#aacbff;font-size:.85rem;display:inline-flex;align-items:center;gap:6px;margin-top:4px;}
        a.back-link:hover {color:#d4e6ff;}
        .grid{display:grid;gap:20px;grid-template-columns:1.4fr 1fr;align-items:start;margin-top:4px}
        .card{background:#121821;border:1px solid #2a3442;border-radius:12px;padding:20px;box-shadow:0 6px 18px rgba(0,0,0,.35)}
        .card h3 {margin:0 0 14px;font-size:1.05rem;font-weight:600;letter-spacing:.5px;color:#b7c6d8;text-transform:uppercase;}
        form {margin:0;padding:0}
        .form-grid{display:grid;grid-template-columns:repeat(2,minmax(260px,340px));justify-content:start;gap:14px}
        .form-grid label {display:flex;flex-direction:column;font-size:.75rem;letter-spacing:.5px;text-transform:uppercase;color:#93a6bc;font-weight:600;gap:4px}
        .input{height:38px;padding:8px 10px;font-size:.92rem;max-width:320px;border:1px solid #2a3442;background:#0e141c;color:#e9f1ff;border-radius:8px;transition:border-color .15s,background .15s}
        .input:focus-visible{outline:2px solid #6aa7ff;outline-offset:2px}
        .inline-fields{display:grid;grid-template-columns:repeat(2,120px);gap:10px;justify-content:start}
        .inline-fields>div{width:120px;padding:6px 8px 10px;border:1px solid #2a3442;border-radius:10px;background:#0e141c;display:flex;flex-direction:column;gap:4px}
        .inline-fields label{font-size:.65rem;color:#8ea3b9;margin:0;text-transform:uppercase;letter-spacing:.5px;font-weight:600}
        button{cursor:pointer;font-weight:600;letter-spacing:.4px}
        .actions{display:flex;gap:12px;margin-top:8px;flex-wrap:wrap}
        .btn{background:#1f63d8;border:1px solid #3478ec;color:#fff;padding:10px 20px;border-radius:8px;font-size:.82rem;text-transform:uppercase;box-shadow:0 3px 10px rgba(15,52,98,.4);}
        .btn:hover{background:#2b73ef}
        .btn.secondary{background:#1b2531;border-color:#2a3442;color:#c6d4e5;box-shadow:none}
        .btn.secondary:hover{background:#233141}
        .btn.outline{background:#121821;color:#c1d1e5;border:1px solid #2a3442}
        .btn.outline:hover{background:#18222e}
        .table-wrap{max-height:60vh;overflow:auto;border:1px solid #223045;border-radius:10px;background:#0f161f;margin-top:4px}
        table.table{width:100%;border-collapse:separate;border-spacing:0;font-size:.74rem;min-width:1250px}
        .table th,.table td{padding:10px 12px;border-bottom:1px solid #223045;vertical-align:middle}
        .table thead th{position:sticky;top:0;background:#14202c;z-index:2;text-align:center;font-weight:700;font-size:.67rem;letter-spacing:.6px;color:#8fb0cc;text-transform:uppercase}
        .table tbody tr:last-child td{border-bottom:none}
        .table td{text-align:right;font-variant-numeric:tabular-nums}
        .table td:first-child{text-align:center;font-weight:600;color:#d4e4f5}
        .muted{color:#88a0b6;font-size:.65rem;letter-spacing:.5px;margin-top:2px}
        .kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:14px}
        .chip{background:#121821;border:1px solid #2a3442;border-radius:10px;padding:14px;display:flex;flex-direction:column;gap:3px;min-height:92px}
        .summary-label{color:#9fb0c7;font-size:.78rem;letter-spacing:.4px;text-transform:uppercase}
        .summary-value{font-size:1.2rem;font-weight:800;margin-top:3px}
        .warn{color:#f7c356}
        .bad{color:#ff6f69}
        .good{color:#64d488}
        .footer-note{margin-top:18px;font-size:.6rem;letter-spacing:.4px;color:#5f7084;text-align:right}
        @media (max-width:1120px){.grid{grid-template-columns:1fr}.table-wrap{max-height:50vh}}
    </style>
</head>
<body>
    <main style="max-width:1650px;margin:26px auto 60px;padding:0 30px 10px;">
        <a href="../html/index.html" class="back-link" aria-label="Volver al menú">← Volver</a>
        <header style="margin-top:6px;margin-bottom:18px;">
            <h1>Inventario de Azúcar (revisión cada 7 días)</h1>
            <p class="subtitle">Modelo de inventario periódico: cada 7 días se revisa y se ordena para llenar la bodega. La demanda diaria es aleatoria (media 100 Kg) y el pedido tarda 1–3 días en llegar. Si no hay stock se pierden ventas. Se consideran costos de ordenar, comprar y mantener.</p>
        </header>
        <div class="grid" id="layout">
            <section class="card" aria-labelledby="parametros-titulo">
                <h3 id="parametros-titulo">Parámetros del modelo</h3>
                <form id="formParametros">
                    <div class="form-grid">
                        <label>NSIM
                            <input type="number" class="input" id="nsim" value="5" min="1" />
                        </label>
                        <label>Horizonte (días)
                            <input type="number" class="input" id="horizonte" value="60" min="1" />
                        </label>
                        <label>Demanda media (Kg/día)
                            <input type="number" class="input" id="demandaMedia" value="100" min="0" step="0.01" />
                        </label>
                        <label>Periodo revisión (días)
                            <input type="number" class="input" id="periodoRevision" value="7" min="1" />
                        </label>
                                    <div style="display:flex;flex-direction:column;gap:6px">
                                        <span style="font-size:.75rem;letter-spacing:.5px;text-transform:uppercase;color:#93a6bc;font-weight:600">Tiempo de entrega en Dias (Uniforme)</span>
                            <div class="inline-fields">
                                <div>
                                    <label for="ltMin">Mín</label>
                                    <input type="number" class="input" id="ltMin" value="1" min="0" style="width:100%;" />
                                </div>
                                <div>
                                    <label for="ltMax">Máx</label>
                                    <input type="number" class="input" id="ltMax" value="3" min="0" style="width:100%;" />
                                </div>
                            </div>
                        </div>
                        <label>Capacidad bodega (Kg)
                            <input type="number" class="input" id="capacidad" value="700" min="0" />
                        </label>
                        <label>Costo ordenar (Bs/orden)
                            <input type="number" class="input" id="costoOrden" value="100" min="0" step="0.01" />
                        </label>
                        <label>Costo mantener (Bs/Kg·día)
                            <input type="number" class="input" id="costoMantener" value="0.1" min="0" step="0.0001" />
                        </label>
                        <label>Costo adquisición (Bs/Kg)
                            <input type="number" class="input" id="costoCompra" value="3.5" min="0" step="0.0001" />
                        </label>
                        <label>Precio venta (Bs/Kg)
                            <input type="number" class="input" id="precioVenta" value="5" min="0" step="0.0001" />
                        </label>
                    </div>
                    <div class="actions">
                        <button type="button" class="btn" id="btnSimular">Simular</button>
                        <button type="button" class="btn secondary" id="btnLimpiar">Limpiar</button>
                        <a href="../html/index.html" class="btn outline" style="display:inline-block;text-decoration:none;">← Volver</a>
                    </div>
                </form>
            </section>
            <section class="card" aria-labelledby="resultados-titulo">
                <h3 id="resultados-titulo">Resultados por simulación</h3>
                <div class="table-wrap" aria-live="polite">
                    <table class="table" id="tablaResultados">
                        <thead>
                            <tr>
                                <th>NSIM</th>
                                <th>Órdenes</th>
                                <th>Demanda (Kg)</th>
                                <th>Ventas (Kg)</th>
                                <th>Perdidas (Kg)</th>
                                <th>Costo ordenar [Bs]</th>
                                <th>Costo mantener [Bs]</th>
                                <th>Costo compra [Bs]</th>
                                <th>Ingresos [Bs]</th>
                                <th>Ganancia neta [Bs]</th>
                                <th>% utilización máx.</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="kpis" id="kpis"></div>
            </section>
        </div>
    </main>
    <script>
        function randUniformInt(min, max){return Math.floor(Math.random()*(max-min+1))+min;}
        function randExponential(mean){const u=Math.random();return -mean*Math.log(1-u);} 
        function format(num, dec=2){return num.toLocaleString('es-VE',{minimumFractionDigits:dec,maximumFractionDigits:dec});}
        function simularInventario(params){
            const {horizonte, demandaMedia, periodoRevision, ltMin, ltMax, capacidad, costoOrden, costoMantener, costoCompra, precioVenta} = params;
            let inventario = capacidad;
            let pedidos = 0, costoOrdenarTotal=0, costoMantenerTotal=0, costoCompraTotal=0, ingresosTotal=0;
            let demandaTotal=0, ventasTotal=0, perdidasTotal=0, inventarioMax=inventario, sumaInventarioPromedioDia=0;
            let pedidoPendiente = null;
                            // Costos iniciales por arrancar lleno (equivalente a haber hecho un pedido antes del día 1)
                            if(capacidad > 0){
                                costoCompraTotal += capacidad * costoCompra;
                                costoOrdenarTotal += costoOrden; // costo de la orden inicial
                                pedidos += 1;
                            }
                            for(let dia=1; dia<=horizonte; dia++){
                        const esDomingo = (dia % periodoRevision) === 0; // Día de cierre / revisión
                if(pedidoPendiente && dia === pedidoPendiente.llegaDia){
                    const cantRecibida = Math.min(pedidoPendiente.cantidad, capacidad - inventario);
                    inventario += cantRecibida; costoCompraTotal += cantRecibida * costoCompra; pedidoPendiente=null; if(inventario>inventarioMax) inventarioMax=inventario;
                }
                const inventarioInicio = inventario;
                        // Revisión ahora en domingos (múltiplos de periodo). Domingos no generan demanda.
                        if(esDomingo){
                            const hueco = capacidad - inventario;
                            if(hueco>0){
                                const qtyPedido = hueco; const lead = randUniformInt(ltMin, ltMax);
                                pedidoPendiente = {cantidad: qtyPedido, llegaDia: dia + lead}; pedidos++; costoOrdenarTotal += costoOrden;
                            }
                        }
                        // Demanda sólo si no es domingo
                        let demanda = esDomingo ? 0 : Math.round(randExponential(demandaMedia));
                        if(demanda<0) demanda=0; demandaTotal += demanda;
                        const ventas = Math.min(demanda, inventario); const perdidas = demanda - ventas;
                        ventasTotal += ventas; perdidasTotal += perdidas; inventario -= ventas;
                const inventarioPromedioDia = (inventarioInicio + inventario)/2; sumaInventarioPromedioDia += inventarioPromedioDia; costoMantenerTotal += inventarioPromedioDia * costoMantener;
                ingresosTotal += ventas * precioVenta; if(inventario>inventarioMax) inventarioMax=inventario;
            }
            const gananciaNeta = ingresosTotal - (costoOrdenarTotal + costoMantenerTotal + costoCompraTotal);
            const inventarioPromedio = sumaInventarioPromedioDia / horizonte; const utilizacionMaxPct = (inventarioMax / capacidad) * 100;
            return {pedidos, demandaTotal, ventasTotal, perdidasTotal, costoOrdenarTotal, costoMantenerTotal, costoCompraTotal, ingresosTotal, gananciaNeta, utilizacionMaxPct, inventarioPromedio};
        }
        function ejecutarSimulaciones(){
            let nsim = parseInt(document.getElementById('nsim').value)||0; if(nsim<1) nsim=1;
            let horizonte = parseInt(document.getElementById('horizonte').value)||0; if(horizonte<1) horizonte=60;
            let demandaMedia = parseFloat(document.getElementById('demandaMedia').value)||0; if(demandaMedia<0) demandaMedia=0;
            let periodoRevision = parseInt(document.getElementById('periodoRevision').value)||0; if(periodoRevision<1) periodoRevision=7;
            let ltMin = parseInt(document.getElementById('ltMin').value)||0; if(ltMin<0) ltMin=0;
            let ltMax = parseInt(document.getElementById('ltMax').value)||0; if(ltMax<ltMin) ltMax=ltMin;
            let capacidad = parseInt(document.getElementById('capacidad').value)||0; if(capacidad<0) capacidad=0;
            let costoOrden = parseFloat(document.getElementById('costoOrden').value)||0; if(costoOrden<0) costoOrden=0;
            let costoMantener = parseFloat(document.getElementById('costoMantener').value)||0; if(costoMantener<0) costoMantener=0;
            let costoCompra = parseFloat(document.getElementById('costoCompra').value)||0; if(costoCompra<0) costoCompra=0;
            let precioVenta = parseFloat(document.getElementById('precioVenta').value)||0; if(precioVenta<0) precioVenta=0;
            const params = {horizonte, demandaMedia, periodoRevision, ltMin, ltMax, capacidad, costoOrden, costoMantener, costoCompra, precioVenta};
            const tbody = document.querySelector('#tablaResultados tbody'); tbody.innerHTML='';
            const resultados=[]; for(let i=1;i<=nsim;i++){ resultados.push(simularInventario(params)); }
            resultados.forEach((r, idx)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${idx+1}</td><td>${r.pedidos}</td><td>${format(r.demandaTotal,0)}</td><td>${format(r.ventasTotal,0)}</td><td>${format(r.perdidasTotal,0)}</td><td>${format(r.costoOrdenarTotal)}</td><td>${format(r.costoMantenerTotal)}</td><td>${format(r.costoCompraTotal)}</td><td>${format(r.ingresosTotal)}</td><td class="${r.gananciaNeta>=0?'good':'bad'}">${format(r.gananciaNeta)}</td><td>${format(r.utilizacionMaxPct,2)}%</td>`; tbody.appendChild(tr); });
            renderKPIs(resultados);
        }
        function renderKPIs(res){ if(!res.length) return; const kpis=document.getElementById('kpis'); kpis.innerHTML='';
            const sum=res.reduce((a,r)=>{a.gn+=r.gananciaNeta;a.perdidas+=r.perdidasTotal;a.demanda+=r.demandaTotal;a.ventas+=r.ventasTotal;a.invProm+=r.inventarioPromedio;return a;},{gn:0,perdidas:0,demanda:0,ventas:0,invProm:0});
            const nivelServicio = sum.demanda? (sum.ventas/sum.demanda)*100:0; const gananciaProm = sum.gn/res.length; const inventarioPromedioGlobal = sum.invProm/res.length; const perdidaRelativa = sum.demanda? (sum.perdidas/sum.demanda):0; const capacidadSuficiente = perdidaRelativa < 0.02 ? 'Sí':'No';
            const chips=[
                {label:'Ganancia neta promedio', value:`Bs ${format(gananciaProm)}`, cls: gananciaProm>=0?'good':'bad'},
                {label:'Demanda insatisfecha total', value:`${format(sum.perdidas,0)} Kg`, cls: sum.perdidas>0?'warn':''},
                {label:'Nivel de servicio (%)', value:`${format(nivelServicio,2)} %`, cls: nivelServicio>=98?'good':(nivelServicio>=90?'':'warn')},
                {label:'Inventario promedio (Kg)', value:`${format(inventarioPromedioGlobal,2)} Kg`},
                {label:'¿Capacidad suficiente?', value:capacidadSuficiente, cls: capacidadSuficiente==='Sí'?'good':'bad'}
            ];
            chips.forEach(c=>{ const div=document.createElement('div'); div.className='chip'; div.innerHTML=`<span class="summary-label">${c.label}</span><span class="summary-value ${c.cls||''}">${c.value}</span>`; kpis.appendChild(div); }); }
        function limpiar(){ document.querySelector('#tablaResultados tbody').innerHTML=''; document.getElementById('kpis').innerHTML=''; }
        document.addEventListener('DOMContentLoaded',()=>{ document.getElementById('btnSimular').addEventListener('click', ejecutarSimulaciones); document.getElementById('btnLimpiar').addEventListener('click', limpiar); });
    </script>
</body>
</html>